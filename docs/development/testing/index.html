<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.74.3" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Testing | Quarks Project</title><meta property="og:title" content="Testing" />
<meta property="og:description" content="Tests description Based on upstreams documentation https://github.com/thtanaka/kubernetes/blob/master/docs/devel/testing.md we use three levels of testing: unit, integration and e2e.
Before starting, run make tools to install the required dependencies.
Running make test executes all the test suites.
We use ginkgo for testing. Every package needs a suite_test.go for setup. It can be generated by running ginkgo bootstrap in the sub folder. Rename the generated file afterwards, to stay consistent. There is also ginkgo generate to create skeleton test files." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://quarks.suse.dev/docs/development/testing/" />
<meta property="article:modified_time" content="2020-08-27T11:10:29+02:00" /><meta property="og:site_name" content="Quarks Project" />
<meta itemprop="name" content="Testing">
<meta itemprop="description" content="Tests description Based on upstreams documentation https://github.com/thtanaka/kubernetes/blob/master/docs/devel/testing.md we use three levels of testing: unit, integration and e2e.
Before starting, run make tools to install the required dependencies.
Running make test executes all the test suites.
We use ginkgo for testing. Every package needs a suite_test.go for setup. It can be generated by running ginkgo bootstrap in the sub folder. Rename the generated file afterwards, to stay consistent. There is also ginkgo generate to create skeleton test files.">
<meta itemprop="dateModified" content="2020-08-27T11:10:29+02:00" />
<meta itemprop="wordCount" content="1616">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Testing"/>
<meta name="twitter:description" content="Tests description Based on upstreams documentation https://github.com/thtanaka/kubernetes/blob/master/docs/devel/testing.md we use three levels of testing: unit, integration and e2e.
Before starting, run make tools to install the required dependencies.
Running make test executes all the test suites.
We use ginkgo for testing. Every package needs a suite_test.go for setup. It can be generated by running ginkgo bootstrap in the sub folder. Rename the generated file afterwards, to stay consistent. There is also ginkgo generate to create skeleton test files."/>







<link rel="preload" href="/scss/main.min.83856f4fe58f890afd31a466bd21dbb5cd927d0e2eb2f03c20cde7066ef2adb2.css" as="style">
<link href="/scss/main.min.83856f4fe58f890afd31a466bd21dbb5cd927d0e2eb2f03c20cde7066ef2adb2.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="394.7368421052631" viewBox="0  0, 400,394.7368421052631"><g id="svgg"><path id="path0" d="M145.181 8.554C145.035 8.699 144.916 9.852 144.916 11.116V13.412L134.551 13.518 124.186 13.623 124.068 16.079 123.951 18.536 118.738 18.646 113.524 18.756 113.408 21.41 113.291 24.064 108.274 24.174 103.258 24.284 103.14 26.741 103.023 29.197 97.81 29.308 92.596 29.418 92.479 31.874 92.362 34.331 87.148 34.441 81.935 34.551 81.819 37.198 81.702 39.845 79.252 39.962 76.802 40.079 76.684 42.529 76.567 44.978 74.118 45.095 71.668 45.212 71.551 47.669 71.434 50.125 66.22 50.235 61.007 50.346 60.891 52.992 60.774 55.639 58.324 55.757 55.874 55.874 55.757 58.324 55.639 60.774 52.992 60.891 50.346 61.007 50.228 63.456 50.111 65.906 47.662 66.023 45.212 66.14 45.102 71.354 44.992 76.567 42.536 76.684 40.079 76.802 39.962 79.252 39.845 81.702 37.198 81.819 34.551 81.935 34.435 84.582 34.318 87.229 31.868 87.346 29.418 87.463 29.307 92.479 29.197 97.495 26.741 97.612 24.284 97.73 24.168 100.377 24.052 103.025 21.404 103.141 18.756 103.258 18.646 108.274 18.535 113.29 16.079 113.407 13.623 113.524 13.516 121.304 13.409 129.084 10.949 129.202 8.49 129.319V144.916 160.513L13.506 160.624 18.522 160.734 18.639 163.19 18.756 165.647 21.403 165.763 24.05 165.879 24.167 168.33 24.284 170.78 26.735 170.897 29.185 171.014 29.301 173.661 29.418 176.308 34.631 176.418 39.844 176.528 39.962 178.985 40.079 181.441 42.529 181.558 44.978 181.675 45.095 184.125 45.212 186.575 50.426 186.685 55.641 186.795 55.757 189.449 55.874 192.103H63.376 70.879L70.983 178.992 71.087 165.881 73.549 165.764 76.012 165.647 76.119 157.866 76.226 150.085 78.883 149.968 81.54 149.852 81.65 144.638 81.76 139.425 84.217 139.308 86.673 139.191 86.79 136.741 86.907 134.291 89.357 134.174 91.807 134.057 91.917 128.843 92.027 123.629 94.681 123.512 97.335 123.396 97.452 120.946 97.569 118.497 100.018 118.38 102.468 118.263 102.585 115.813 102.702 113.363 105.152 113.246 107.601 113.129 107.718 110.482 107.834 107.834 110.482 107.718 113.129 107.601 113.246 105.152 113.363 102.702 115.813 102.585 118.263 102.468 118.38 100.011 118.497 97.555 123.711 97.445 128.924 97.335 129.04 94.681 129.157 92.027 134.174 91.917 139.191 91.807 139.308 89.35 139.425 86.893 144.638 86.783 149.852 86.673 149.969 84.212 150.087 81.75 160.433 81.645 170.78 81.54 170.897 78.875 171.013 76.209H192.318 213.623V78.973 81.737H221.52 229.418V84.304 86.871H237.315 245.212V89.437 92.004H247.761 250.309L250.426 94.669 250.543 97.335 255.775 97.445 261.007 97.555V100.11 102.665H263.555 266.102L266.22 105.133 266.338 107.601 268.788 107.718 271.238 107.835 271.355 110.482 271.471 113.129 274.136 113.246 276.802 113.363V115.911 118.46H279.349 281.897L282.015 120.928 282.132 123.396 284.583 123.513 287.033 123.63 287.149 126.277 287.266 128.924 289.931 129.041 292.596 129.158V134.273 139.388H295.151 297.707L297.817 144.62 297.927 149.852 300.384 149.969 302.84 150.086 302.95 155.3 303.06 160.513 305.726 160.63 308.391 160.747V171.193 181.639H310.949 313.507L313.615 189.437 313.722 197.236 324.068 197.341 334.415 197.446 334.532 199.908 334.65 202.369H355.38 376.111L376.228 199.901 376.346 197.433H378.893 381.441V179.072 160.711H378.881 376.321L376.216 150.346 376.111 139.98 373.651 139.863 371.191 139.746 371.084 131.966 370.977 124.186 368.312 124.069 365.647 123.952V118.639 113.327H363.092 360.537L360.426 108.292 360.316 103.258 357.859 103.14 355.403 103.023 355.293 97.81 355.183 92.596 352.517 92.479 349.852 92.363V89.814 87.266H347.297 344.742L344.631 82.034 344.521 76.802 342.072 76.684 339.622 76.567 339.505 74.118 339.388 71.668 336.723 71.552 334.057 71.435V68.689 65.943H331.509 328.962L328.844 63.475 328.727 61.007 326.277 60.89 323.827 60.773 323.71 58.323 323.593 55.874 320.928 55.757 318.263 55.64V52.894 50.148H315.715 313.167L313.049 47.68 312.932 45.212 307.7 45.102 302.468 44.992V42.437 39.882H299.919 297.371L297.254 37.216 297.137 34.551 291.905 34.441 286.673 34.33V31.775 29.22H281.559 276.444L276.327 26.752 276.209 24.284 270.995 24.174 265.781 24.064 265.664 21.41 265.548 18.756 260.316 18.646 255.084 18.536V15.981 13.425H244.639 234.194L234.076 10.958 233.959 8.49 189.702 8.389C165.361 8.334 145.327 8.408 145.181 8.554" stroke="none" fill="#fff" fill-rule="evenodd"/><path id="path1" d="M3.03 192.561C2.884 192.707 2.764 193.952 2.764 195.327V197.828H1.382.0V210.859 223.889H1.377 2.753L2.857 236.821 2.962 249.753 5.619 249.87 8.276 249.986 8.383 257.767 8.49 265.548 10.949 265.665 13.409 265.783 13.516 273.563 13.623 281.343 16.079 281.46 18.536 281.577 18.646 286.791 18.756 292.004 21.403 292.12 24.05 292.237 24.167 294.687 24.284 297.137 26.741 297.254 29.197 297.372 29.308 302.585 29.418 307.799 31.867 307.916 34.317 308.033 34.434 310.482 34.551 312.932 37.199 313.048 39.846 313.165 39.963 315.812 40.079 318.46 42.535 318.577 44.991 318.695 45.102 323.711 45.212 328.727 47.663 328.844 50.113 328.961 50.229 331.608 50.346 334.255 52.992 334.371 55.639 334.487 55.757 336.938 55.874 339.388 58.323 339.505 60.773 339.622 60.89 342.072 61.007 344.521 66.221 344.631 71.435 344.741 71.552 347.395 71.668 350.049 74.118 350.166 76.567 350.284 76.684 352.733 76.802 355.183 79.251 355.3 81.701 355.417 81.818 357.866 81.935 360.316 87.149 360.426 92.363 360.536 92.48 363.19 92.596 365.844 97.81 365.954 103.023 366.064 103.14 368.521 103.258 370.977 108.274 371.088 113.29 371.198 113.407 373.654 113.524 376.111 118.738 376.221 123.953 376.331 124.069 378.985 124.186 381.639 134.532 381.744 144.879 381.849 144.996 384.311 145.114 386.772h44.422 44.423L234.076 384.304 234.194 381.836H244.639 255.084V379.084 376.331L260.316 376.221 265.548 376.111 265.665 373.654 265.782 371.197 270.996 371.087 276.209 370.977 276.327 368.509 276.444 366.041H281.559 286.673V363.289 360.536L291.905 360.426 297.137 360.316 297.255 357.848 297.372 355.38H299.92 302.468V352.825 350.27L307.7 350.16 312.932 350.049 313.049 347.384 313.165 344.719H315.714 318.263V342.17 339.621L320.928 339.505 323.593 339.388 323.71 336.938 323.827 334.489 326.277 334.372 328.727 334.255 328.843 331.589 328.96 328.924H331.509 334.057V326.375 323.827L336.723 323.71 339.388 323.593 339.505 321.144 339.622 318.694 342.072 318.577 344.521 318.46 344.631 313.228 344.742 307.996H347.297 349.852V305.447 302.899L352.517 302.782 355.183 302.665 355.293 297.452 355.403 292.238 357.859 292.121 360.316 292.004 360.426 286.772 360.536 281.54H363.091 365.647V276.425 271.31L368.312 271.193 370.977 271.076 371.084 263.296 371.191 255.516 373.651 255.399 376.111 255.281V247.581 239.882L373.661 239.764 371.211 239.647 371.094 237.198 370.977 234.748 368.312 234.632 365.647 234.515V231.966 229.418H360.531 355.416L355.299 226.752 355.183 224.087 352.517 223.97 349.852 223.853V221.305 218.756H347.304 344.756L344.639 216.288 344.521 213.82 339.289 213.71 334.057 213.6V210.847 208.095H331.509 328.962L328.844 205.627 328.727 203.159H321.224 313.722L313.611 208.391 313.501 213.623H310.946 308.391V224.069 234.515L305.726 234.632 303.06 234.748 302.95 239.962 302.84 245.175 300.384 245.292 297.927 245.41 297.816 250.444 297.706 255.479H295.151 292.596V260.791 266.104L289.931 266.221 287.266 266.338 287.148 268.787 287.031 271.237 284.582 271.354 282.132 271.471 282.016 274.136 281.899 276.802H279.35 276.802V279.35 281.899L274.136 282.016 271.471 282.132 271.354 284.582 271.237 287.031 268.787 287.148 266.338 287.266 266.221 289.931 266.104 292.596H263.556 261.007V295.151 297.707L255.775 297.817 250.543 297.927 250.425 300.395 250.308 302.863H247.76 245.212V305.627 308.391H237.315 229.418V310.958 313.524H221.52 213.623V316.091 318.657H189.752 165.882L165.764 316.19 165.647 313.722 157.867 313.615 150.087 313.508 149.969 311.048 149.852 308.588 144.638 308.478 139.424 308.368 139.307 305.714 139.191 303.06 134.175 302.95 129.159 302.839 129.041 300.383 128.924 297.927 123.711 297.817 118.497 297.707 118.38 295.25 118.263 292.794 115.812 292.677 113.362 292.559 113.246 289.913 113.129 287.266 110.482 287.149 107.835 287.033 107.718 284.583 107.601 282.132 105.152 282.015 102.702 281.898 102.585 279.449 102.468 276.999 100.018 276.882 97.567 276.765 97.451 274.118 97.335 271.471 94.681 271.354 92.027 271.238 91.917 266.221 91.807 261.204 89.356 261.087 86.906 260.97 86.79 258.323 86.673 255.676 84.217 255.559 81.761 255.442 81.65 250.426 81.54 245.41 78.883 245.293 76.226 245.177 76.119 237.396 76.012 229.615 73.548 229.498 71.085 229.38 70.982 213.703 70.879 198.026 65.664 197.916 60.45 197.806 60.334 195.152 60.217 192.498 31.756 192.396C16.103 192.341 3.176 192.415 3.03 192.561" stroke="none" fill="#14241c" fill-rule="evenodd"/><path id="path2" stroke="none" fill="#0cc0b0" fill-rule="evenodd"/><path id="path3" stroke="none" fill="#0cc0b0" fill-rule="evenodd"/><path id="path4" stroke="none" fill="#0cc0b0" fill-rule="evenodd"/></g></svg></span><span class="text-uppercase font-weight-bold">Quarks Project</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/community/" ><span>Community</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.a23375ad01f84a3089610fdb7bc159869bf22b600a74814dd745aa32579833a0da6167f486305d0de849aa9327e26311a2a60627334ff8e277dc91043bfe53d7.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.a23375ad01f84a3089610fdb7bc159869bf22b600a74814dd745aa32579833a0da6167f486305d0de849aa9327e26311a2a60627334ff8e277dc91043bfe53d7.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-operator/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks Operator</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-operator">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatoroverview" href="/docs/quarks-operator/overview/">Overview</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorinstall" href="/docs/quarks-operator/install/">Install</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-operator/cli/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks-operator</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-operatorcli">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator" href="/docs/quarks-operator/cli/cf-operator/">/cf-operator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_util" href="/docs/quarks-operator/cli/cf-operator_util/">/cf-operator util</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_util_instance-group" href="/docs/quarks-operator/cli/cf-operator_util_instance-group/">/cf-operator util instance-group</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_util_tail-logs" href="/docs/quarks-operator/cli/cf-operator_util_tail-logs/">/cf-operator util tail-logs</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_util_template-render" href="/docs/quarks-operator/cli/cf-operator_util_template-render/">/cf-operator util template-render</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_util_wait" href="/docs/quarks-operator/cli/cf-operator_util_wait/">/cf-operator util wait</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_version" href="/docs/quarks-operator/cli/cf-operator_version/">/cf-operator version</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorclicf-operator_util_variable-interpolation" href="/docs/quarks-operator/cli/cf-operator_util_variable-interpolation/">cf-operator util variable-interpolation</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-operator/concepts/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-operatorconcepts">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsfrom_bosh_to_kube" href="/docs/quarks-operator/concepts/from_bosh_to_kube/">Transforming BOSH concepts to Kubernetes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsdesired_manifests" href="/docs/quarks-operator/concepts/desired_manifests/">Desired Manifests</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsvariables" href="/docs/quarks-operator/concepts/variables/">BOSH Variables</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsrendering_templates" href="/docs/quarks-operator/concepts/rendering_templates/">Rendering BOSH Templates</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsresources_limit" href="/docs/quarks-operator/concepts/resources_limit/">BOSH resource requests and limits</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsentanglements" href="/docs/quarks-operator/concepts/entanglements/">Entanglements</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptsprocess_control" href="/docs/quarks-operator/concepts/process_control/">Process Control</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatorconceptswaiting_services" href="/docs/quarks-operator/concepts/waiting_services/">Waiting for services</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatortroubleshooting" href="/docs/quarks-operator/troubleshooting/">Troubleshooting</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-operator/development/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Development</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-operatordevelopment">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatordevelopmentreleasing" href="/docs/quarks-operator/development/releasing/">Releasing</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-operator/development/controllers/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Controllers</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-operatordevelopmentcontrollers">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatordevelopmentcontrollersbosh_deployment" href="/docs/quarks-operator/development/controllers/bosh_deployment/">BOSH Deployment</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatordevelopmentcontrollersquarks_restart" href="/docs/quarks-operator/development/controllers/quarks_restart/">Quarks restart</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-operatordevelopmentlabels" href="/docs/quarks-operator/development/labels/">Labels</a>
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-job/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks Job</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-job">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-job/cli/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks Job</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-jobcli">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-jobcliquarks-job" href="/docs/quarks-job/cli/quarks-job/">/quarks-job</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-jobcliquarks-job_persist-output" href="/docs/quarks-job/cli/quarks-job_persist-output/">/quarks-job persist-output</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-jobcliquarks-job_version" href="/docs/quarks-job/cli/quarks-job_version/">/quarks-job version</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-job/development/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Development</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-jobdevelopment">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-secret/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks Secret</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-secret">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-secret/cli/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks Secret</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-secretcli">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-secretcliquarks-secret" href="/docs/quarks-secret/cli/quarks-secret/">/quarks-secret</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-secretcliquarks-secret_version" href="/docs/quarks-secret/cli/quarks-secret_version/">/quarks-secret version</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-secret/development/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Development</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-secretdevelopment">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-statefulset/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quarks Statefulset</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-statefulset">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/quarks-statefulset/development/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Development</a>
  </li>
  <ul>
    <li class="collapse " id="docsquarks-statefulsetdevelopment">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsquarks-statefulsetdevelopmentstatefulsetrollout" href="/docs/quarks-statefulset/development/statefulsetrollout/">StatefulSet Rollout</a>
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/development/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Development</a>
  </li>
  <ul>
    <li class="collapse show" id="docsdevelopment">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevelopmentbuilding" href="/docs/development/building/">Build quarks-operator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-docsdevelopmenttesting" href="/docs/development/testing/">Testing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevelopmentabout_operators" href="/docs/development/about_operators/">About operators</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevelopmenttooling" href="/docs/development/tooling/">Tooling</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevelopmentnaming" href="/docs/development/naming/">Naming Conventions</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/contribution-guidelines/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contribution Guidelines</a>
  </li>
  <ul>
    <li class="collapse " id="docscontribution-guidelines">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            






<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/cloudfoundry-incubator/quarks-docs/edit/master/content/en/docs/Development/testing.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudfoundry-incubator/quarks-docs/issues/new?title=Testing" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/cloudfoundry-incubator/quarks-operator/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#tests-description">Tests description</a></li>
    <li><a href="#unit">Unit</a>
      <ul>
        <li><a href="#setup-ruby">Setup Ruby</a></li>
      </ul>
    </li>
    <li><a href="#integration">Integration</a>
      <ul>
        <li><a href="#webhook-configuration"><strong>Webhook Configuration</strong></a></li>
      </ul>
    </li>
    <li><a href="#end-to-end">End-to-End</a></li>
    <li><a href="#running-tests">Running tests</a>
      <ul>
        <li><a href="#in-minikube">In minikube</a></li>
        <li><a href="#in-kind">In KinD</a></li>
      </ul>
    </li>
    <li><a href="#makefile">Makefile</a>
      <ul>
        <li><a href="#general-targets">General Targets</a></li>
        <li><a href="#build-targets">Build Targets</a></li>
        <li><a href="#test-targets">Test Targets</a></li>
        <li><a href="#generate-targets">Generate Targets</a></li>
      </ul>
    </li>
    <li><a href="#ci">CI</a></li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://quarks.suse.dev/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://quarks.suse.dev/docs/development/">Development</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://quarks.suse.dev/docs/development/testing/">Testing</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Testing</h1>
    
	       
	<h2 id="tests-description">Tests description</h2>
<p>Based on upstreams documentation <a href="https://github.com/thtanaka/kubernetes/blob/master/docs/devel/testing.md">https://github.com/thtanaka/kubernetes/blob/master/docs/devel/testing.md</a> we use three levels of testing: <code>unit</code>, <code>integration</code> and <code>e2e</code>.</p>
<p>Before starting, run <code>make tools</code> to install the required dependencies.</p>
<p>Running <code>make test</code> executes all the test suites.</p>
<p>We use ginkgo for testing. Every package needs a <code>suite_test.go</code> for setup. It can be generated by running <code>ginkgo bootstrap</code> in the sub folder. Rename the generated file afterwards, to stay consistent.
There is also <code>ginkgo generate</code> to create skeleton test files.</p>
<h2 id="unit">Unit</h2>
<p>While unit testing we:</p>
<ul>
<li>test classes in isolation</li>
<li>pass all dependencies to the constructor, so we can inject fakes for testing</li>
<li>use <code>counterfeiter</code> and <code>gomock</code>/<code>mockgen</code> to generate and update fakes and mocks</li>
<li>don&rsquo;t test private methods, tests are in a separate <code>_test</code> package</li>
<li>try not to nest ginkgo contexts too deep and keep tests DRY by extracting useful helpers</li>
<li>assert incoming messages produce the expected state</li>
<li>assert outgoing commands happened, like a file gets written</li>
<li>assert all handled error cases are triggered</li>
<li>can ignore outgoing queries, which only change internal state</li>
</ul>
<h3 id="setup-ruby">Setup Ruby</h3>
<p>Ruby gem for template rendering</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gem install bosh-template
</code></pre></td></tr></table>
</div>
</div><h2 id="integration">Integration</h2>
<p>Integration tests formulate expectations on the interactions of several components.
They require access to a Kubernetes, preferably <code>minikube</code>.</p>
<p>Integration tests start our operator directly, bypassing the command line.
They do require the operator <a href="#upload-operator-image">docker image</a> and the <code>bosh-template</code> Ruby gem.</p>
<p>The <code>environment</code> package provides helpers to start the operator, get the kubeconfig and use the clients to create objects.
In <code>testing</code> the <code>catalog</code> defines test objects.</p>
<p>Integration tests use a special logger, which does not log to stdout and whose messages can be accessed as a an array by calling <code>env.AllLogMessages()</code>.</p>
<p>When using <code>bin/test-integration</code> the integration tests are run in parallel.
Each Ginkgo test node has a separate namespace, log file and webhook server port and certificate.</p>
<p>The node index starts at 1 and is used as following to generate names:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">namespace: <span style="color:#40ffff">$TEST_NAMESPACE</span> + &lt;node_index&gt;
webhook port: <span style="color:#40ffff">$CF_OPERATOR_WEBHOOK_SERVICE_PORT</span> + &lt;node_index&gt;
log file: <span style="color:#40ffff">$CF_OPERATOR_TESTING_TMP</span>/cf-operator-tests-&lt;node_index&gt;.log
</code></pre></td></tr></table>
</div>
</div><p>Integration tests use the <code>TEST_NAMESPACE</code> environment variable as a base to
calculate the namespace name. Test namespaces are deleted automatically once
the tests are completed.</p>
<p><code>CF_OPERATOR_TESTING_TMP</code> can be used to set a tmp directory for storing logs
and other files generated during testing. If this variable is not set <code>/tmp</code>
will be used instead.</p>
<p>The tests will create some NodePort services; normally the test can detect an IP
address automatically. <code>CF_OPERATOR_NODE_IP</code> can set to the node IP of any
arbitrary node to override this (e.g. for OpenStack Kubernetes clusters).</p>
<p>Generated files will be cleand up after the test run unless <code>SKIP_CF_OPERATOR_TESTING_TMP_CLEANUP</code>
is set to <code>true</code>.</p>
<h3 id="webhook-configuration"><strong>Webhook Configuration</strong></h3>
<p>Quarks StatefulSet requires a k8s webhook to mutate the volumes of a pod.
Kubernetes will call back to the operator for certain requests and use the
modified pod manifest, which is returned.
CF-Operator also uses a validating webhook to validate the BOSH deployment spec and the creation
of reference resources specified in the spec. Secret validation admission webhook restricts the
user from updating a versioned secret.</p>
<p>The cf-operator integration tests use <code>CF_OPERATOR_WEBHOOK_SERVICE_PORT</code> as a
base value to calculate the port number to listen to on <code>CF_OPERATOR_WEBHOOK_SERVICE_HOST</code>.</p>
<p>The tests use a <code>mutatingwebhookconfiguration</code> and a <code>validatingwebhookconfiguration</code> to configure Kubernetes to
connect to this address. The address needs to be reachable from the cluster.</p>
<p>The configuration only applies to a single namespace, by using a selector. It contains the URL of the webhooks, build from
<code>CF_OPERATOR_WEBHOOK_SERVICE_HOST</code> and the calculated port.
It also contains SSL certificates and CA, which are necessary to connect to the webhook.</p>
<p><em><strong>Note</strong></em>: If you have issues to start integration tests, and they fail by contacting the webhook server, for example if you see a error message like:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    Unexpected error:                                                                                                                
          &lt;*errors.StatusError | 0xc0002b4780&gt;: {                                                                                      
              ErrStatus: {                                                                                                             
                  TypeMeta: {Kind: <span style="color:#ed9d13">&#34;&#34;</span>, APIVersion: <span style="color:#ed9d13">&#34;&#34;</span>},                                                                                
                  ListMeta: {                                                                                                          
                      SelfLink: <span style="color:#ed9d13">&#34;&#34;</span>,                                                                                                    
                      ResourceVersion: <span style="color:#ed9d13">&#34;&#34;</span>,                                                                                             
                      Continue: <span style="color:#ed9d13">&#34;&#34;</span>,
                      RemainingItemCount: nil,                                                                                         
                  },                                               
                  Status: <span style="color:#ed9d13">&#34;Failure&#34;</span>,                                                                                                   
                  Message: <span style="color:#ed9d13">&#34;Internal error occurred: failed calling webhook \&#34;mutate-statefulsets.quarks.cloudfoundry.org\&#34;: Post https://192.168.100.66:40603/mutate-statefulsets?timeout=30s: dial tcp 192.168.100.66:40603: connect: no route to host&#34;</span>,
                  Reason: <span style="color:#ed9d13">&#34;InternalError&#34;</span>,                                                                                             
                  Details: {                                                                                                           
                      Name: <span style="color:#ed9d13">&#34;&#34;</span>,                                                                                                        
                      Group: <span style="color:#ed9d13">&#34;&#34;</span>,                                   
                      Kind: <span style="color:#ed9d13">&#34;&#34;</span>,                                                                                                        
                      UID: <span style="color:#ed9d13">&#34;&#34;</span>,                                     
                      Causes: [                                                                                                        
                          {                                        
                              Type: <span style="color:#ed9d13">&#34;&#34;</span>,                                                                                                
                              Message: <span style="color:#ed9d13">&#34;failed calling webhook \&#34;mutate-statefulsets.quarks.cloudfoundry.org\&#34;: Post https://192.168.100.66:40603/mutate-statefulsets?timeout=30s: dial tcp 192.168.100.66:40603: connect: no route to host&#34;</span>,
                              Field: <span style="color:#ed9d13">&#34;&#34;</span>,                                                                                               
                          },                                                                                                           
                      ],                                                                                                               
                      RetryAfterSeconds: 0,                        
                  },                                                                                                                   
                  Code: 500,                                                                                                           
              },                                                                                                                       
          }                                                       
</code></pre></td></tr></table>
</div>
</div><p>Check your firewall if it&rsquo;s preventing the webhook server to be contacted from your target cluster or either if <code>CF_OPERATOR_WEBHOOK_SERVICE_HOST</code> is configured correctly</p>
<p>The certificates and keys are written to disk, so the webhook server can use
them.  They are also cached in a k8s secret for production, but that is not
being used in integration tests, since they delete the test namespaces.</p>
<p>Tests suites should clean up their, namespace dependant, webhook configuration automatically.</p>
<h2 id="end-to-end">End-to-End</h2>
<p>The e2e tests are meant to test acceptance scenarios. They are written from an end user perspective.
They are split into two types, &lsquo;cli&rsquo; and &lsquo;kube&rsquo;.</p>
<p>The e2e CLI test exercise different command line options and commands which don&rsquo;t need a running Kubernetes, like template rendering.
The CLI tests build the operator binary themselves.</p>
<p>The second type of e2e tests use <code>helm</code> to install the CF operator into the k8s cluster and use the files from <code>docs/examples</code> for testing.</p>
<h2 id="running-tests">Running tests</h2>
<h3 id="in-minikube">In minikube</h3>
<p>The following steps are necessary to have a proper environment setup, where all types of tests can be executed:</p>
<ol>
<li>
<p>Start <code>minikube</code></p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">minikube start --kubernetes-version v1.15.5
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Switch to minikube docker daemon</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">eval</span> <span style="color:#6ab825;font-weight:bold">$(</span>minikube docker-env<span style="color:#6ab825;font-weight:bold">)</span>
</code></pre></td></tr></table>
</div>
</div><p><em><strong>Note</strong></em>: Template rendering for BOSH jobs is done at deployment time by the operator
binary. Therefore the operator docker image needs to be made available to
Kubernetes cluster.</p>
</li>
<li>
<p>Export the <code>CF_OPERATOR_WEBHOOK_SERVICE_HOST</code> env variable</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">export</span> <span style="color:#40ffff">CF_OPERATOR_WEBHOOK_SERVICE_HOST</span>=<span style="color:#6ab825;font-weight:bold">$(</span>ip -4 a s dev <span style="color:#6ab825;font-weight:bold">$(</span>ip r l 0/0 | cut -f5 -d<span style="color:#ed9d13">&#39; &#39;</span><span style="color:#6ab825;font-weight:bold">)</span> | grep -oP <span style="color:#ed9d13">&#39;inet \K\S+(?=/)&#39;</span><span style="color:#6ab825;font-weight:bold">)</span>
</code></pre></td></tr></table>
</div>
</div><p><em><strong>Note</strong></em>: On Mac, use <code>export CF_OPERATOR_WEBHOOK_SERVICE_HOST=$(ip a s $(ip r g 0/0 | cut -f5 -d' ') | grep -oE 'inet [^ /]+' | cut -f2 -d' ')</code>, because grep cannot handle perl regexs.
<em><strong>Note</strong></em>: You can also find the correct IP, by running <code>ip addr</code>. The IP address under <code>vboxnet1</code> is the IP that you need.</p>
</li>
<li>
<p>Export the <code>OPERATOR_TEST_STORAGE_CLASS</code> env variable</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">export</span> <span style="color:#40ffff">OPERATOR_TEST_STORAGE_CLASS</span>=standard
</code></pre></td></tr></table>
</div>
</div><p><em><strong>Note</strong></em>: Require for the PVC test creation, in minikube.</p>
</li>
<li>
<p>Ensure <code>GO111MODULE</code> is set</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">export</span> <span style="color:#40ffff">GO111MODULE</span>=on
</code></pre></td></tr></table>
</div>
</div><p><em><strong>Note</strong></em>: When you have a vendor folder (either from the submodule or manually created) settings this to <code>off</code> speeds up the <code>build-image</code> target.</p>
</li>
<li>
<p>Build the <code>cf-operator</code> binary</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bin/build
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Build the <code>cf-operator</code> docker image</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bin/build-image
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><em><strong>Note</strong></em>: Consider setting <code>DOCKER_IMAGE_TAG</code> to a fixed variable. This will avoid rebuilding the docker image everytime, when doing changes in files not related to the <code>cf-operator</code>
binary.</p>
<p><em><strong>Note</strong></em>: When not running in CI, nothing ensures a proper cleanup of resources after the deletion of the <code>cf-operator</code> in the environment. You can make sure to manually verify that none
old resources will interfere with a future installation, by:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-style:italic"># Deleting old mutating webhooks configurations</span>
kubectl get mutatingwebhookconfiguration -oname | xargs -n <span style="color:#3677a9">1</span> kubectl delete
</code></pre></td></tr></table>
</div>
</div><h3 id="in-kind">In KinD</h3>
<p>The following steps are necessary to have a proper environment setup, where all types of tests can be executed:</p>
<ol>
<li>Install <code>KinD</code></li>
</ol>
<p>Follow the instructions from <a href="https://github.com/kubernetes-sigs/kind/">https://github.com/kubernetes-sigs/kind/</a></p>
<ol>
<li>
<p>Start cluster</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kind create cluster --image kindest/node:v1.15.6
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Export the <code>CF_OPERATOR_WEBHOOK_SERVICE_HOST</code> env variable. Use the IP of the docker bridge or your public IP. Firewall rules may interfere.</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">export</span> <span style="color:#40ffff">CF_OPERATOR_WEBHOOK_SERVICE_HOST</span>=<span style="color:#6ab825;font-weight:bold">$(</span>ip -4 a s dev <span style="color:#6ab825;font-weight:bold">$(</span>ip r l 0/0 | cut -f5 -d<span style="color:#ed9d13">&#39; &#39;</span><span style="color:#6ab825;font-weight:bold">)</span> | grep -oP <span style="color:#ed9d13">&#39;inet \K\S+(?=/)&#39;</span><span style="color:#6ab825;font-weight:bold">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><em><strong>Note</strong></em>: On Mac, use <code>export CF_OPERATOR_WEBHOOK_SERVICE_HOST=$(ip a s $(ip r g 0/0 | cut -f5 -d' ') | grep -oE 'inet [^ /]+' | cut -f2 -d' ')</code>, because grep cannot handle perl regexs.</p>
<ol>
<li>
<p>Export the <code>OPERATOR_TEST_STORAGE_CLASS</code> env variable</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">export</span> <span style="color:#40ffff">OPERATOR_TEST_STORAGE_CLASS</span>=standard
</code></pre></td></tr></table>
</div>
</div><p><em><strong>Note</strong></em>: Required for the PVC tests.</p>
</li>
<li>
<p>Build the <code>cf-operator</code> docker image</p>
<p>First set the version to something static, not dependant on git:</p>
<div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#24909d">export</span> <span style="color:#40ffff">DOCKER_IMAGE_TAG</span>=<span style="color:#ed9d13">${</span><span style="color:#40ffff">DOCKER_IMAGE_TAG</span><span style="color:#6ab825;font-weight:bold">:-</span><span style="color:#40ffff">dev</span><span style="color:#ed9d13">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bin/build-image
</code></pre></td></tr></table>
</div>
</div><p>Or if you have local changes and use <code>go mod edit --replace</code>,
follow the instructions from <a href="../../development#standalone-components">standalone components</a>.</p>
</li>
<li>
<p>Load image into KinD</p>
<pre><code>kind load docker-image cfcontainerization/cf-operator:$DOCKER_IMAGE_TAG
</code></pre></li>
<li>
<p>Set QuarksJob dependency. Choose a tag from <a href="https://hub.docker.com/r/cfcontainerization/quarks-job/tags">docker.io</a>.</p>
<pre><code>export QUARKS_JOB_IMAGE_TAG=${QUARKS_JOB_IMAGE_TAG:-dev}
</code></pre><p>If using a locally built quarks-job image, load it via</p>
<p><code>kind load docker-image cfcontainerization/quarks-job:$QUARKS_JOB_IMAGE_TAG</code></p>
<p>(see <a href="../../development#standalone-components">standalone components</a>).</p>
</li>
</ol>
<h2 id="makefile">Makefile</h2>
<p>The following are the make targets available and their actions. When building and running the targets manually on the quarks-operator codebase, please set <code>PROJECT=quarks-operator</code>.</p>
<p>The common scripts between the <code>quarks-operator</code> components are in the <code>quarks-utils</code> <a href="https://github.com/cloudfoundry-incubator/quarks-utils/">project</a>. To download them, make sure to run <code>bin/tools-shared</code> or <code>make tools</code> before running any other script/target.</p>
<h3 id="general-targets">General Targets</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>all</code></td>
<td>install dependencies, run tests and builds <code>cf-operator</code> binary.</td>
</tr>
<tr>
<td><code>up</code></td>
<td>starts the operator using the binary created by <code>build</code> make target.</td>
</tr>
<tr>
<td><code>vet</code></td>
<td>runs the code analyzing tool <code>vet</code> to identify problems in the source code.</td>
</tr>
<tr>
<td><code>lint</code></td>
<td>runs <code>go lint</code>to identify style mistakes.</td>
</tr>
<tr>
<td><code>tools</code></td>
<td>installs go dependencies required to <code>cf-operator</code>.</td>
</tr>
<tr>
<td><code>check-scripts</code></td>
<td>runs <code>shellcheck</code> to identify syntax, semmantic and subtle caveats in shell scripts.</td>
</tr>
</tbody>
</table>
<h3 id="build-targets">Build Targets</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>build</code></td>
<td>builds the <code>cf-operator</code> binary.</td>
</tr>
<tr>
<td><code>build-image</code></td>
<td>builds the <code>cf-operator</code> docker image.</td>
</tr>
<tr>
<td><code>build-helm</code></td>
<td>builds the <code>cf-operator</code> helm tar file.</td>
</tr>
</tbody>
</table>
<h3 id="test-targets">Test Targets</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test</code></td>
<td>runs unit,integration and e2e tests.</td>
</tr>
<tr>
<td><code>test-unit</code></td>
<td>runs unit tests only.</td>
</tr>
<tr>
<td><code>test-integration</code></td>
<td>runs integration tests only.</td>
</tr>
<tr>
<td><code>test-cli-e2e</code></td>
<td>runs end to end tests for CLI.</td>
</tr>
<tr>
<td><code>test-helm-e2e</code></td>
<td>runs end to end tests on k8s using <code>helm install</code>.</td>
</tr>
<tr>
<td><code>test-integration-storage</code></td>
<td>runs integration storage tests.</td>
</tr>
<tr>
<td><code>test-helm-e2e-storage</code></td>
<td>runs e2e storage tests.</td>
</tr>
</tbody>
</table>
<h3 id="generate-targets">Generate Targets</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>generate</code></td>
<td>runs <code>gen-kube</code> and <code>gen-fakes</code>.</td>
</tr>
<tr>
<td><code>gen-kube</code></td>
<td>generates kube client,informers, lister code.</td>
</tr>
<tr>
<td><code>gen-fakes</code></td>
<td>generates fake objects for unit testing.</td>
</tr>
<tr>
<td><code>gen-command-docs</code></td>
<td>generates docs for all commands.</td>
</tr>
<tr>
<td><code>verify-gen-kube</code></td>
<td>informs if you need to run <code>gen-kube</code> make target.</td>
</tr>
</tbody>
</table>
<h2 id="ci">CI</h2>
<p>Our Concourse pipeline definitions are kept in the <a href="https://github.com/cloudfoundry-incubator/cf-operator-ci">cf-operator-ci</a> repo.</p>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified August 27, 2020: <a  href="https://github.com/cloudfoundry-incubator/quarks-docs/commit/b79d3900d72de289d45d87f5e8f9110f7a8ec231">Merge pull request #10 from cloudfoundry-incubator/component-docs-174254540 (b79d390)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/cloudfoundry-incubator/quarks-operator/">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" href="https://cloudfoundry.slack.com/archives/C1BQKKNP4">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2020 CloudFoundry.org Foundation, Inc. All Rights Reserved. All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>









<script src="/js/main.min.664f21bf5eb0c31ebc661e2616e6c63e0448cec6d5636d869957be423c3cb952.js" integrity="sha256-Zk8hv16wwx68Zh4mFubGPgRIzsbVY22GmVe&#43;Qjw8uVI=" crossorigin="anonymous"></script>



  </body>
</html>